---
sidebar_position: 6
description: Quality gates and testing strategies
---

# Testing & Validation

This guide covers testing strategies, validation tools, and quality assurance for the design tokens package.

## Testing Overview

The design tokens package uses multiple layers of testing:

1. **Unit Tests** – Runtime helpers and utilities
2. **Integration Tests** – Downstream package compatibility
3. **Validation Scripts** – Token structure integrity
4. **Type Checking** – TypeScript compilation

## Unit Testing

### Running Tests

```bash
# Run all tests
pnpm run test

# Run in watch mode
pnpm run test -- --watch

# Run with coverage
pnpm run test -- --coverage
```

### Test Framework

The package uses [Vitest](https://vitest.dev/) for unit testing:

```typescript
// src/__tests__/runtime.test.ts
import { describe, expect, it } from 'vitest'
import { getThemeTokens, listThemeNames, createTheme } from '../index'

describe('getThemeTokens', () => {
  it('should return light theme tokens', () => {
    const tokens = getThemeTokens('light')
    expect(tokens).toBeDefined()
    expect(tokens.color).toBeDefined()
  })

  it('should return dark theme tokens', () => {
    const tokens = getThemeTokens('dark')
    expect(tokens).toBeDefined()
    expect(tokens.color).toBeDefined()
  })
})
```

### Test Coverage

Key areas covered by tests:

- **Runtime Helpers** – `getThemeTokens`, `createTheme`, `listThemeNames`
- **Token Integrity** – Validation utilities
- **Theme Cloning** – Deep copy and merge logic
- **Type Safety** – TypeScript definitions

## Token Validation

### Running Validation

```bash
pnpm run validate
```

This executes `src/run-validation.ts` which:

- Ensures all required token sections exist in each theme
- Validates token structure matches expected schema
- Checks for missing or malformed tokens

### Validation Script

```typescript
// src/run-validation.ts
import { validateThemes } from './validation'
import { themes } from './generated/themes'

const result = validateThemes(themes)

if (!result.valid) {
  console.error('Token validation failed:')
  result.errors.forEach(error => console.error(`  - ${error}`))
  process.exit(1)
}

console.log('✓ All tokens validated successfully')
```

### Custom Validation Rules

Add custom rules in `src/validation.ts`:

```typescript
// src/validation.ts
export function validateThemes(themes: Record<string, any>) {
  const errors: string[] = []
  
  // Check required sections
  const requiredSections = ['color', 'typography', 'size', 'shadow']
  
  for (const [themeName, theme] of Object.entries(themes)) {
    for (const section of requiredSections) {
      if (!theme[section]) {
        errors.push(`Missing section "${section}" in theme "${themeName}"`)
      }
    }
  }
  
  return {
    valid: errors.length === 0,
    errors
  }
}
```

## Type Checking

### Running Type Check

```bash
pnpm run typecheck
```

This runs TypeScript compiler without emitting files:

```json
// tsconfig.json
{
  "compilerOptions": {
    "noEmit": true,
    "strict": true,
    "skipLibCheck": false
  }
}
```

### Type Safety Benefits

- Catches errors early in development
- Ensures runtime matches type definitions
- Validates generated `themes.ts` structure
- Verifies custom transforms don't break types

## Integration Testing

### Testing Downstream Packages

After token changes, test dependent packages:

```bash
# Test design token package
pnpm --filter @designgreat/lib-design-token build

# Test component library
pnpm --filter @designgreat/lib-web-component build
pnpm --filter @designgreat/lib-web-component test

# Test documentation site
pnpm --filter @designgreat/docs-design-system build
```

### CSS Variable Integration

Test that CSS variables are correctly generated:

```bash
# Check generated CSS files
cat packages/lib-design-token/dist/css/light/variables.css
cat packages/lib-design-token/dist/css/dark/variables.css

# Check TypeScript exports
cat packages/lib-design-token/src/generated/themes.ts
```

### Visual Regression Testing

Use Storybook to verify visual changes:

```bash
# Build tokens and component library
pnpm --filter @designgreat/lib-design-token build
pnpm --filter @designgreat/lib-web-component build

# Start Storybook
pnpm --filter @designgreat/lib-web-component run storybook
```

Compare component renders before and after token changes.

## Quality Gates

Run all checks before committing:

```bash
pnpm run lint && pnpm run test && pnpm run typecheck && pnpm run validate
```

For publishing checks, see [Publishing](./publishing).

## Next Steps

- Review [Troubleshooting](./troubleshooting) for common issues
- See [Publishing](./publishing) for Git workflow and PR process
- Understand the [Build System](./build-system)

