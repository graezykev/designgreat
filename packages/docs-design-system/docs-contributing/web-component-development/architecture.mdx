---
sidebar_position: 2
description: Package structure, build pipeline, and design philosophy
---

# Architecture

This page explains the architecture and design decisions of the `@designgreat/lib-web-component` component library.

## Package Overview

The component library provides React components built with design tokens, Tailwind utilities, and Storybook documentation.

## Build Artifacts

```
dist/
├── lib-web-component.css           # Complete CSS bundle (tokens + utilities + components)
├── index.js                 # ESM entry point
├── index.cjs                # CommonJS entry point
├── index.d.ts               # TypeScript definitions
└── components/              # Individual component bundles
    ├── Button.js
    ├── TextInput.js
    └── Dialog.js
```

## CSS Bundling Strategy

The library uses [CSS Cascade Layers](https://developer.mozilla.org/en-US/docs/Web/CSS/@layer) for predictable styling:

| Layer | Priority | Contents |
|-------|----------|----------|
| `dg-tokens` | Lowest | Design token CSS variables |
| `dg-components` | Middle | Component styles (Button, Dialog, etc.) |
| (unlayered) | Highest | Tailwind utilities — always wins |

### Source File Structure

```
src/styles/
├── index.css        # @layer declarations + token import
├── tailwind.css     # Components layer + @tailwind utilities
└── components.css   # Component-specific styles
```

### Import Chain

```
src/index.ts
  └─> styles/index.css
       │
       ├─> @layer dg-tokens, dg-components;     ← Layer order declaration
       │
       ├─> @designgreat/lib-design-token/css    ← Wrapped in @layer dg-tokens
       │
       └─> tailwind.css
            ├─> components.css                  ← Wrapped in @layer dg-components
            └─> @tailwind utilities             ← Unlayered (highest priority)
```

### What's Included

The distributed CSS (`dist/lib-web-component.css`) includes:

- ✅ `@layer` declarations for cascade control
- ✅ Design token CSS variables (`:root` for light, `.dg-theme-dark` for dark)
- ✅ Component styles in `dg-components` layer
- ✅ Tailwind utilities (unlayered for maximum override priority)

### What's Excluded

The distributed CSS intentionally **excludes**:

- ❌ `@font-face` declarations — fonts imported separately from `@designgreat/lib-design-token/font`
- ❌ Tailwind base layer — no CSS resets that might conflict
- ❌ Tailwind components layer — no unwanted utility classes

### Why This Matters

This architecture allows consumers to:

- Load fonts independently (self-hosted or via CDN)
- Integrate with existing projects without CSS conflicts
- Override component styles with utility classes: `<Button className="bg-red-500">`
- Control font loading strategy (preload, async, etc.)

:::tip For Consumers
See [Installation Guide](/web-component/guides/installation#tailwind-projects) for CSS layer integration with Tailwind v3/v4.
:::

## Dependency Flow

```
┌────────────────────────────────────┐
│  @designgreat/lib-design-token     │
│  (Design Tokens)                   │
│  • CSS variables (colors, spacing) │
│  • Typography values               │
│  • Font files + font-face.css      │
└──────────────┬─────────────────────┘
               │ consumed by
               ▼
┌────────────────────────────────────┐
│  @designgreat/lib-web-component    │
│  (Component Library)               │
│  • React components                │
│  • CSS layers (dg-tokens, dg-components)
│  • Tailwind config (token-aware)   │
│  • Component styles                │
└────────────────────────────────────┘
```

## Project Structure

```
packages/lib-web-component/
├── .storybook/              # Storybook configuration
│   ├── main.ts              # Vite + addons + telemetry config
│   └── preview.tsx          # Global decorators + font import
├── src/
│   ├── components/          # React components
│   │   ├── Button/
│   │   │   ├── Button.tsx
│   │   │   ├── Button.test.tsx
│   │   │   └── Button.stories.tsx
│   │   ├── TextInput/
│   │   └── Dialog/
│   ├── styles/              # CSS architecture (with @layer)
│   │   ├── index.css        # Layer order + token import
│   │   ├── tailwind.css     # Components layer + utilities
│   │   └── components.css   # Component-specific styles
│   ├── storybook/           # Storybook utilities
│   │   └── CodeDemoToggle.tsx
│   └── index.ts             # Package entry point
├── tailwind.config.ts       # Tailwind configuration (token-aware)
├── vite.config.ts           # Vite build configuration
├── jest.config.ts           # Jest test configuration
└── package.json
```

## Build Pipeline

```
┌───────────────────────────┐
│  pnpm build pipeline      │
│  • clean                  │
│  • tsc -p tsconfig.build  │ ← Type check and emit .d.ts
│  • vite build (ESM/CJS)   │ ← Bundle components and CSS
│  • storybook build        │ ← Build static Storybook site
└──────────────┬────────────┘
               │
               ▼
┌───────────────────────────┐
│  Published package        │
│  • Clean CSS              │ ← No fonts, no Tailwind resets
│  • ESM + CJS modules      │
│  • TypeScript types       │
└───────────────────────────┘
```

**Key Point**: The `generate:theme` step has been **removed**. Design tokens are now directly imported from `@designgreat/lib-design-token`.

## Next Steps

- Learn about [Design Token Integration](./design-token-integration) for token generation
- Understand [Font Handling](./font-handling) for font loading strategy
- Review [Publishing](./publishing) for package distribution
- Follow the [Storybook Workflow](./storybook-workflow) for component development
- Check [Troubleshooting](./troubleshooting) for common issues

