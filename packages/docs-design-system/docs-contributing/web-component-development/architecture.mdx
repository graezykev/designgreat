---
sidebar_position: 2
description: Package structure, build pipeline, and design philosophy
---

# Architecture

This page explains the architecture and design decisions of the `@designgreat/lib-web-component` component library.

## Package Overview

The component library provides React components built with design tokens, Tailwind utilities, and Storybook documentation.

## Build Artifacts

```
dist/
├── lib-web-component.css           # Complete CSS bundle (tokens + utilities + components)
├── index.js                 # ESM entry point
├── index.cjs                # CommonJS entry point
├── index.d.ts               # TypeScript definitions
└── components/              # Individual component bundles
    ├── Button.js
    ├── TextInput.js
    └── Dialog.js
```

## CSS Bundling Strategy

### CSS Cascade Layers

The library uses [CSS Cascade Layers](https://developer.mozilla.org/en-US/docs/Web/CSS/@layer) for predictable styling and easy overrides:

```
Layer Priority (lowest → highest):
┌─────────────────┐
│ dg-tokens       │  Design tokens (CSS variables)
├─────────────────┤
│ dg-components   │  Component styles (Button, Dialog, etc.)
├─────────────────┤
│ (unlayered)     │  Tailwind utilities — always wins
└─────────────────┘
```

This architecture ensures:
- **Consumer utilities override library styles** — `<Button className="bg-red-500">` works as expected
- **Predictable cascade** — Layer order is explicit, not dependent on import order
- **Tailwind v3 & v4 compatible** — Works with both versions

### Import Chain

```
src/index.ts
  └─> styles/index.css
       │
       ├─> @layer dg-tokens, dg-components;     ← Layer order declaration
       │
       ├─> @designgreat/lib-design-token/css    ← Wrapped in @layer dg-tokens
       │
       └─> tailwind.css
            ├─> components.css                  ← Wrapped in @layer dg-components
            └─> @tailwind utilities             ← Unlayered (highest priority)
```

### What's Included

The distributed CSS (`dist/lib-web-component.css`) includes:

- ✅ `@layer` declarations for cascade control
- ✅ Design token CSS variables (`:root` for light, `.dg-theme-dark` for dark) — in `dg-tokens` layer
- ✅ Component-specific styles — in `dg-components` layer
- ✅ Tailwind utilities only — unlayered for maximum override priority

### What's Excluded

The distributed CSS intentionally **excludes**:

- ❌ `@font-face` declarations (fonts must be imported separately)
- ❌ Tailwind base layer (no CSS resets)
- ❌ Tailwind components layer (no unwanted utility classes)

This allows consumers to:

- Load fonts independently (from `@designgreat/lib-design-token/font` or via CDN)
- Integrate seamlessly with existing projects without CSS reset conflicts
- Control font loading strategy (preload, async, etc.)
- Avoid duplicate CSS when already using Tailwind
- Override component styles with utility classes or custom layers

### Theme CSS Order

The distributed CSS includes both light and dark themes in a specific order to ensure proper CSS cascade:

1. **`:root { ... }`** - Light theme variables (applied by default)
2. **`.dg-theme-dark { ... }`** - Dark theme variables (override when class is present)

This ordering ensures that when the `.dg-theme-dark` class is applied to the `<html>` element, dark theme variables correctly override the light theme defaults.

## Dependency Flow

```
┌────────────────────────────────────┐
│  @designgreat/lib-design-token     │
│  (Design Tokens)                   │
│  • CSS variables (colors, spacing) │
│  • Typography values               │
│  • Font files + font-face.css      │
└──────────────┬─────────────────────┘
               │ consumed by
               ▼
┌────────────────────────────────────┐
│  @designgreat/lib-web-component    │
│  (Component Library)               │
│  • React components                │
│  • CSS layers (dg-tokens, dg-components)
│  • Tailwind config (token-aware)   │
│  • Component styles                │
└────────────────────────────────────┘
```

## Project Structure

```
packages/lib-web-component/
├── .storybook/              # Storybook configuration
│   ├── main.ts              # Vite + addons + telemetry config
│   └── preview.tsx          # Global decorators + font import
├── src/
│   ├── components/          # React components
│   │   ├── Button/
│   │   │   ├── Button.tsx
│   │   │   ├── Button.test.tsx
│   │   │   └── Button.stories.tsx
│   │   ├── TextInput/
│   │   └── Dialog/
│   ├── styles/              # CSS architecture (with @layer)
│   │   ├── index.css        # Layer order + token import
│   │   ├── tailwind.css     # Components layer + utilities
│   │   └── components.css   # Component-specific styles
│   ├── storybook/           # Storybook utilities
│   │   └── CodeDemoToggle.tsx
│   └── index.ts             # Package entry point
├── tailwind.config.ts       # Tailwind configuration (token-aware)
├── vite.config.ts           # Vite build configuration
├── vitest.config.ts         # Vitest test configuration
└── package.json
```

## Build Pipeline

```
┌───────────────────────────┐
│  pnpm build pipeline      │
│  • clean                  │
│  • tsc -p tsconfig.build  │ ← Type check and emit .d.ts
│  • vite build (ESM/CJS)   │ ← Bundle components and CSS
│  • storybook build        │ ← Build static Storybook site
└──────────────┬────────────┘
               │
               ▼
┌───────────────────────────┐
│  Published package        │
│  • Clean CSS              │ ← No fonts, no Tailwind resets
│  • ESM + CJS modules      │
│  • TypeScript types       │
└───────────────────────────┘
```

**Key Point**: The `generate:theme` step has been **removed**. Design tokens are now directly imported from `@designgreat/lib-design-token`.

## Next Steps

- Learn about [Design Token Integration](./design-token-integration) for token generation
- Understand [Font Handling](./font-handling) for font loading strategy
- Review [Publishing](./publishing) for package distribution
- Follow the [Storybook Workflow](./storybook-workflow) for component development
- Check [Troubleshooting](./troubleshooting) for common issues

