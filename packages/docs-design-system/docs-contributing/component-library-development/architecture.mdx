---
sidebar_position: 2
description: Package structure, build pipeline, and design philosophy
---

# Architecture

This page explains the architecture and design decisions of the `@designgreat/lib-web-ui` component library.

## Package Overview

The component library provides React components built with design tokens, Tailwind utilities, and Storybook documentation.

## Build Artifacts

```
dist/
├── lib-web-ui.css           # Complete CSS bundle (tokens + utilities + components)
├── index.js                 # ESM entry point
├── index.cjs                # CommonJS entry point
├── index.d.ts               # TypeScript definitions
└── components/              # Individual component bundles
    ├── Button.js
    ├── TextInput.js
    └── Dialog.js
```

## CSS Bundling Strategy

### Import Chain

The library uses a clean, semantic import chain:

```
src/index.ts
  └─> styles/index.css (single CSS entry point)
       ├─> @designgreat/lib-web-ui-design-token/css (design tokens)
       └─> tailwind.css
            ├─> @tailwind utilities (NO base, NO components)
            └─> components.css (component styles)
```

### What's Included

The distributed CSS (`dist/lib-web-ui.css`) includes:

- ✅ Design token CSS variables (`:root` for light, `.dg-theme-dark` for dark)
- ✅ Tailwind utilities only (no resets to avoid conflicts)
- ✅ Component-specific styles

### What's Excluded

The distributed CSS intentionally **excludes**:

- ❌ `@font-face` declarations (fonts must be imported separately)
- ❌ Tailwind base layer (no CSS resets)
- ❌ Tailwind components layer (no unwanted utility classes)

This allows consumers to:

- Load fonts independently (from `@designgreat/lib-web-ui-design-token/font` or via CDN)
- Integrate seamlessly with existing projects without CSS reset conflicts
- Control font loading strategy (preload, async, etc.)
- Avoid duplicate CSS when already using Tailwind

### Theme CSS Order

The distributed CSS includes both light and dark themes in a specific order to ensure proper CSS cascade:

1. **`:root { ... }`** - Light theme variables (applied by default)
2. **`.dg-theme-dark { ... }`** - Dark theme variables (override when class is present)

This ordering ensures that when the `.dg-theme-dark` class is applied to the `<html>` element, dark theme variables correctly override the light theme defaults.

## Dependency Flow

```
┌────────────────────────────────────┐
│  @designgreat/lib-web-ui-design-   │
│  token (Design Tokens)             │
│  • CSS variables (colors, spacing) │
│  • Typography values               │
│  • Font files + font-face.css      │
└──────────────┬─────────────────────┘
               │ consumed by
               ▼
┌────────────────────────────────────┐
│  @designgreat/lib-web-ui           │
│  (Component Library)               │
│  • React components                │
│  • Tailwind config (token-aware)   │
│  • Component styles                │
└────────────────────────────────────┘
```

## Project Structure

```
packages/lib-web-ui/
├── .storybook/              # Storybook configuration
│   ├── main.ts              # Vite + addons + telemetry config
│   └── preview.tsx          # Global decorators + font import
├── src/
│   ├── components/          # React components
│   │   ├── Button/
│   │   │   ├── Button.tsx
│   │   │   ├── Button.test.tsx
│   │   │   └── Button.stories.tsx
│   │   ├── TextInput/
│   │   └── Dialog/
│   ├── styles/              # CSS architecture
│   │   ├── index.css        # Main entry (tokens + tailwind)
│   │   ├── tailwind.css     # Tailwind utilities + components
│   │   └── components.css   # Component-specific styles
│   ├── storybook/           # Storybook utilities
│   │   └── CodeDemoToggle.tsx
│   └── index.ts             # Package entry point
├── tailwind.config.ts       # Tailwind configuration (token-aware)
├── vite.config.ts           # Vite build configuration
├── vitest.config.ts         # Vitest test configuration
└── package.json
```

## Build Pipeline

```
┌───────────────────────────┐
│  pnpm build pipeline      │
│  • clean                  │
│  • tsc -p tsconfig.build  │ ← Type check and emit .d.ts
│  • vite build (ESM/CJS)   │ ← Bundle components and CSS
│  • storybook build        │ ← Build static Storybook site
└──────────────┬────────────┘
               │
               ▼
┌───────────────────────────┐
│  Published package        │
│  • Clean CSS              │ ← No fonts, no Tailwind resets
│  • ESM + CJS modules      │
│  • TypeScript types       │
└───────────────────────────┘
```

**Key Point**: The `generate:theme` step has been **removed**. Design tokens are now directly imported from `@designgreat/lib-web-ui-design-token`.

## Next Steps

- Learn about [Design Token Integration](./design-token-integration) for token generation
- Understand [Font Handling](./font-handling) for font loading strategy
- Review [Publishing](./publishing) for package distribution
- Follow the [Storybook Workflow](./storybook-workflow) for component development
- Check [Troubleshooting](./troubleshooting) for common issues

